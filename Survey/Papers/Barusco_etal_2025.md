# Evaluating Modern Visual Anomaly Detection Approaches in Semiconductor Manufacturing: A Comparative Study

- **著者**：Manuel Barusco, Francesco Borsatti, Youssef Ben Khalifa, Davide Dalle Pezze, Gian Antonio Susto（イタリア・パドヴァ大学）
- **掲載形態**：プレプリント（arXiv）として2025年5月12日に公開。([arXiv][1])
- **分野**：自動外観検査、半導体製造、視覚異常検知（VAD：Visual Anomaly Detection）

---

## 内容詳細

### 背景と目的

- 半導体製造工場では、ウェーハ加工、金属配線、エッチングなど多数の工程を経てICが作られる。これらの工程では **顕微鏡（特に走査電子顕微鏡 SEM）画像** による自動外観検査（AVI）が重要であり、欠陥の早期発見によって歩留まり改善・設備停止削減・コスト低減が期待される。([arXiv][2])
- これまで多くの研究が「正常＋異常ラベル付き画像を用いた教師あり学習」ベースで進められてきたが、異常サンプルの入手やラベル付けが困難という実運用上の壁がある。([arXiv][2])
- この論文では、**正常サンプルのみを用いる異常検知（VAD）手法**を、半導体製造分野のSEM画像に対して適用・比較評価することを目的としている。これにより、実用的な検査システム構築のヒントや現在の技術の限界を明らかにしようとしている。

### データセットと手法

- 使用データセット：MIIC (Microscopic Images of Integrated Circuits)。IC金属層を撮影したグレースケールSEM画像から構成され、25,276枚（うち正常25,160枚、異常116枚）、解像度512×512ピクセル。([arXiv][2])
- なぜ重要か：多くのVAD研究では自然画像（たとえば自動車部品、ナッツ、ねじなど）を対象にしており、SEMなど専門的・工業的撮像モードの評価は少ないため、**半導体ドメイン特有のチャレンジ**が存在する。([arXiv][2])
- 比較手法：9つのVAD手法を検証。
  - 特徴ベース（feature-based）手法：Pre-trained ネットワーク等から特徴を抽出 → 正常データの特徴記憶・異常データとの乖離を検知。
  - 再構成ベース（reconstruction-based）手法：正常画像を再構成するモデルを学習 → 再構成誤差が大きい場合を異常と判断。([arXiv][2])
- 評価指標：画像レベル（その画像が異常かどうか）およびピクセルレベル（異常箇所のマスク精度）でF1スコア、ROC-AUCなどを採用。([arXiv][2])

### 主な実験結果

- 画像レベルROC-AUCでは、いくつかの特徴ベース手法が90%以上の性能を示している（例：PatchCore 約93.3%、FastFlow 約97.6%）([arXiv][2])
- 画像レベルF1スコアでは、特徴ベース手法の中で特に CFA が約87.9% と最良を記録。([arXiv][2])
- ピクセルレベル（異常領域の局所化）では、画像レベルで最良だった手法が必ずしも最良ではなく、たとえば別手法（たとえば STFPM）が最良スコアという結果も出ている。([arXiv][2])
- 驚くべきことに、再構成ベース手法（古典的アプローチ）も非常に高い性能を記録しており、画像レベルF1で約91.2%という結果も報告されている。([arXiv][2])

### 考察・示唆

- **ドメインギャップ**：自然写真画像で学習・評価された手法をSEM画像にそのまま適用すると、性能が落ちる可能性があることが示唆されている。特徴抽出器が自然写真とSEMとで大きく異なる“視覚特性”を持つためである。([arXiv][2])
- **再構成ベースの再評価**：データが十分にある（この研究では25K枚以上の正常画像）場合、再構成ベース手法でも優れた性能を示し、特徴ベース手法と肩を並べる可能性があるという点が重要である。([arXiv][2])
- **運用上の実用性・説明可能性**：VAD手法は異常が出た領域の“異常マップ（どのピクセルが原因か）”を出すことが多く、エンジニアや品質保証担当者が“なぜ異常と判定されたか”を確認しやすいため、実工場への適用を想定した観点で有利である。([arXiv][2])

### 限界と今後の課題

- 116枚という異常サンプル数は少なく、異常の“多様性”や未知異常への対応という観点では制限がある。
- SEM画像という非常に専門的なモダリティであるため、世界中の研究が再現できるデータ・手法基盤（公開性・汎用性）をもっと拡充する必要がある。
- 特徴ベース手法をさらに改善するためには、ImageNet等自然画像で学習された特徴抽出器を**SEM用途にファインチューニング**したり、自己教師あり学習 (self-supervised) によるドメイン特化特徴学習を検討すべきと論文は提示している。([arXiv][2])
- 実運用では、異常発生頻度が非常に低く、ラベル付き異常がほとんど存在しないという状況が一般的。そのため“一般化／未見異常対応／真陽性／偽陽性のバランス”という観点でさらなる研究が必要である。

---

## 応用の観点から見たポイント（「半導体製造／異常検知AI」文脈で）

- この論文は **SEM画像の異常検知**という点で、「半導体製造における欠陥検出／画像分類／AIモデル構築」という文脈に非常に合致している。
- 正常データのみから学習するVADアプローチは、製造ラインで「出現頻度が少ない異常」を扱う場面において実運用メリットが大きく、ラベル付き異常データが少ない現場に向けた手法選定の重要なガイドになる。
- さらに、「画像レベル＋ピクセルレベル」での性能差／手法ごとの得意・不得意（検出 vs 局所化）を明示しているため、アプリケーション設計時に「欠陥検出するだけでよいか／どこで欠陥があるかも示したいか」という要件整理のヒントになる。
- また、「再構成ベースでも十分戦える」という点は、モデル選定時に“最新最先端＝特徴ベースしかあり得ない”という先入観を見直すきっかけになり得る。
- 実装時には、論文中のベンチマーク設定（画像解像度、正常訓練枚数、異常テスト枚数、使用手法のハイパーパラメータ等）を参照し、検証時のデータセット規模・画像仕様・ライン要件に合致させて “どの手法から試行するか” を決める良い出発点となる。

---

[1]: https://arxiv.org/abs/2505.07576?utm_source=chatgpt.com "Evaluating Modern Visual Anomaly Detection Approaches in Semiconductor Manufacturing: A Comparative Study"
[2]: https://arxiv.org/pdf/2505.07576?utm_source=chatgpt.com "Evaluating Modern Visual Anomaly Detection Approaches ..."

---

## 使用データセット

### ✅ 入手可能性

- データセットの詳細ページが Nanyang Technological University（NTU）によるデータリポジトリ “DR-NTU (Data)” 上に公開されている。([researchdata.ntu.edu.sg][3])
- GitHub 上にも “wenbihan/MIIC-IAD” というリポジトリがあり、データ説明およびダウンロードリンク（あるいはアクセス方法）が記載されている。([GitHub][4])
- データセットには「正常 25,160 枚／異常 116 枚、解像度 512×512 ピクセル」の SEM 画像で構成されている旨が記載されている。([oar.a-star.edu.sg][5])

---

### ⚠ 利用前の注意・条件

- 利用条件として「非商用研究利用のみ（Non-Commercial）」の旨が明記されている。たとえば、GitHub の README に「All data is subject to copyright and may only be used for non-commercial research.」とある。([GitHub][4])
- ライセンスは NTU のデータページ上で “CC BY-NC 4.0” と記載されている。([researchdata.ntu.edu.sg][3])
- ダウンロードにはアカウント登録や利用申請が必要な場合がある（特にファイルが “Request Access” 状態の場合があるようだ）。([researchdata.ntu.edu.sg][3])

---

### 🔍 ユーザー視点での確認ポイント

- 「商用利用」または「ライン実運用（量産品質管理）用途」でこのデータを使いたい場合、ライセンス制限（非商用）を確認・交渉する必要がある。
- 解像度や画像形式（512×512グレー画像）、異常マスク付き／バウンディングボックス付きといったアノテーション内容も把握できる（READMEに記載あり）。([GitHub][4])
- 自社の製造ラインで撮影している SEM 画像とこのデータセットの画質・条件（撮影装置／金属層／被検部位）とのギャップを検討することが重要である。
- ラベル付き異常が「116枚」と少数であるため、「未知異常」「発生頻度の極めて低い異常」への適用を考える際には注意が必要である。これは論文中でも実験条件の限界として言及されている。([arXiv][6])

---

[3]: https://researchdata.ntu.edu.sg/dataset.xhtml?persistentId=doi%3A10.21979%2FN9%2FWBLTFI&utm_source=chatgpt.com "MIIC (Microscopic Images of Integrated Circuits) Dataset for ..."
[4]: https://github.com/wenbihan/MIIC-IAD?utm_source=chatgpt.com "MIIC Dataset for Image Anomaly Detection - GitHub"
[5]: https://oar.a-star.edu.sg/storage/5/5gqr8v86x3/icip-2021-sagan-final.pdf?utm_source=chatgpt.com "[PDF] joint anomaly detection and inpainting for microscopy images"
[6]: https://arxiv.org/html/2505.07576v1?utm_source=chatgpt.com "Evaluating Modern Visual Anomaly Detection Approaches in ... - arXiv"

---

## 9VAD手法

- ※ 本表は「正常データみだけ用いた異常検知（VAD：Visual Anomaly Detection）手法」で、製造業／半導体外観検査という文脈に適用可能なものとして選ばれている。論文中では課題や実験条件（例えば解像度512×512、正常25,160枚／異常116枚のSEM画像）を元に比較がなされている。 ([arXiv][7])
- ※ “実装公開状況”は2025年10月時点の一般公開状況に基づく簡易評価である。

| No | 手法名                                                | 特徴概要                                                                                                           | 実装公開状況                | メリット                           | デメリット                                  |
| -- | -------------------------------------------------- | -------------------------------------------------------------------------------------------------------------- | --------------------- | ------------------------------ | -------------------------------------- |
| 1  | PaDiM (Patch Distribution Modeling)                | 正常パッチの特徴分布を空間 (patch位置) ごとに多変量ガウスでモデル化し、テスト時はマハラノビス距離で異常を検知。 ([Semantic Scholar][8])                           | オープンソース実装あり（GitHub 等） | シンプルで計算量が比較的低め／パッチ位置空間情報を活用できる | メモリ使用が増加しやすい／未知異常で特徴が大きくずれた場合対応が難しい    |
| 2  | PatchCore                                          | 正常パッチを特徴抽出して「メモリバンク (代表パッチ集合)」を作成、テスト時の特徴と近傍距離を計算して異常スコア化。論文では半導体ドメインでも高精度を示した。 ([Moonlight][9])               | 多数実装公開あり              | 非常に高精度を達成している報告多数／メモリバンク方式で直感的 | メモリ・検索コストが高く、ライン用途でのリアルタイム適用に課題あり      |
| 3  | CFA (Coupled Feature Adaptation)                   | 正常パッチの埋め込みを「カップルハイパースフィア (hypersphere)」構造へと適合させ、異常時はその範囲から外れるという仮定で検知。論文では半導体用途で最良値を示した手法の一つ。 ([Moonlight][9]) | 実装あり（GitHub 等）        | 高精度かつ比較的メモリ効率も良好との報告あり         | ハイパーパラメータ調整が必要／他ドメイン（SEM以外）での検証がやや少ない  |
| 4  | FastFlow                                           | 正常特徴の分布を正規化フロー (normalizing flow) モデルで学習し、テスト特徴の尤度低下により異常を検知。論文では最も高いROC‐AUCを記録した。 ([arXiv][10])               | 実装あり（多くの VAD ベンチマークで） | 尤度ベースゆえにスコア解釈性あり／高精度           | フロー構築や推論コストが高め／大規模データ・高解像度化で遅くなる可能性あり  |
| 5  | STFPM (Student-Teacher Feature Prediction Model)   | 教師‐生徒構造をとり、正常画像を教師ネットワーク・生徒ネットワークで処理し、生徒の予測誤差が大きい箇所を異常と判断。教師が「正常特徴」を学び、生徒が模倣を学ぶ方式。 ([Moonlight][9])            | 一部実装あり                | 再構成／特徴予測型のため異常箇所の局所化が得意        | 教師ネットワークの設計が重要／学習データ偏りに弱い              |
| 6  | RIAD (Reconstruction-Inpainting Anomaly Detection) | 正常画像に対し「マスク（削除）→インペインティング」学習を行い、テスト画像では予測誤差が大きいマスク領域を異常とする。再構成型の一種。 ([Moonlight][9])                           | 実装あり (論文付属)           | 再構成方式ゆえ未知異常でも反応しやすい／解釈性あり      | 再構成失敗＝異常という仮定ゆえ、テクスチャ変化・照明変化でも誤検知しやすい  |
| 7  | GANomaly                                           | 敵対生成ネットワーク (GAN) を用し、正常画像の再構成および潜在空間距離を使って異常を検知。正常分布をGANで学び、生成誤差や潜在差をスコアとする。 ([Moonlight][9])                  | 複数実装あり                | GANを活用して特徴／生成誤差を活用できる          | GANの学習が不安定／半導体高解像度画像では訓練が難しい可能性あり      |
| 8  | f‑anoGAN (fast-AnoGAN)                             | 元来の AnoGAN を改良し、エンコーダを別途学習して潜在空間への写像を高速化。正常分布をGANで学び、画像を潜在‐再構成し差分スコアで異常検知。 ([Moonlight][9])                    | 実装あり                  | 潜在距離・再構成両方を扱える／比較的古典手法ゆえ理解しやすい | 最新の特徴ベース手法と比べて精度がやや劣る／高解像度画像では訓練コストが高い |
| 9  | IAD+Inpainting (Inpainting Anomaly Detection)      | 正常画像を部分マスクし、そのマスクをインペインティング再構成させることで正常パターンを学習。テスト時に再構成誤差が大きい箇所を異常とする。再構成型。 ([arXiv][7])                        | 実装あり（関連論文で）           | テクスチャ・パターンの異常を捉えやすい／比較的シンプル    | マスク設計が手作業／照明変化・撮像条件変動に弱い可能性あり          |

### 補足解説・活用メモ

- 本比較表を、ユーザーが「半導体製造／欠陥検出AI／SEM画像」を扱う文脈で活用する場合、以下点が設計・実装段階で特に重要である:
  1. **正常データ量・異常データ量の制限**：本論文では正常25,160枚／異常116枚というかなり偏った構成であり、ラベル付き異常が極めて少ないため、正常のみ学習型（VAD）手法が前提となっている。これは実製造ラインでも典型的な状況である。
  2. **SEM画像という専門撮像モード**：多くのVAD手法は自然画像 (例：MVTec AD 等) を前提としている。SEM画像はテクスチャ・コントラスト・ノイズ特性が異なるため、“ドメイン適応”あるいは“ファインチューニング”を要する可能性がある。論文でもこのドメインギャップを指摘している。 ([arXiv][7])
  3. **リアルタイム適用／実運転環境**：製造ラインへの適用を想定するなら、メモリ・推論速度・FPGA/エッジ環境での実装性／誤検知／未見異常対応といった実装上の課題がある。上表の「メリット／デメリット」欄から実装設計時にどの手法が“現場仕様”に近いかを判断できる。
  4. **実装公開状況の確認**：実際に試作・実験するなら、GitHub 等で「実装済」「動作確認済」の手法を優先した方が早期検証が可能である。例えばPaDiM・PatchCore・FastFlow 等は実装が比較的充実している。
  5. **どこを重視するかで選定**：「画像レベル（異常かどうか）精度を重視するか」「ピクセルレベル（異常領域どこか）も重視するか」「推論速度／モデルサイズを重視するか」によって、上記手法の適合度が変わる。たとえば、「どこに異常があるかも示したい」なら、PatchCore・CFA・STFPM 等が有利である可能性がある。

[7]: https://arxiv.org/html/2505.07576v1?utm_source=chatgpt.com "Evaluating Modern Visual Anomaly Detection Approaches ..."
[8]: https://www.semanticscholar.org/paper/PaDiM%3A-a-Patch-Distribution-Modeling-Framework-for-Defard-Setkov/2e8d62277e40d465343e8dfb32ecc246f320540e?utm_source=chatgpt.com "a Patch Distribution Modeling Framework for Anomaly ..."
[9]: https://www.themoonlight.io/en/review/evaluating-modern-visual-anomaly-detection-approaches-in-semiconductor-manufacturing-a-comparative-study?utm_source=chatgpt.com "[Literature Review] Evaluating Modern Visual Anomaly Detection ..."
[10]: https://arxiv.org/pdf/2505.07576?utm_source=chatgpt.com "[PDF] Evaluating Modern Visual Anomaly Detection Approaches in ... - arXiv"

---

### 🔍 Barusco et al. (2025) による 9 VAD 手法 比較（MIIC データセット）

| No | 手法名                                                | 特徴概要                                             | 実装公開状況 | メリット      | デメリット         | **Image-level ROC-AUC [%]** | **Image-level F1 [%]** | **Pixel-level ROC-AUC [%]** | **Pixel-level F1 [%]** | **Pixel-level PRO [%]** |
| -- | -------------------------------------------------- | ------------------------------------------------ | ------ | --------- | ------------- | --------------------------- | ---------------------- | --------------------------- | ---------------------- | ----------------------- |
| 1  | PaDiM (Patch Distribution Modeling)                | 正常パッチの特徴分布を空間ごとに多変量ガウスでモデル化し、テスト時にマハラノビス距離で異常検知。 | OSS あり | シンプル／低計算量 | メモリ増大／未知異常に弱い | 84.89                       | –                      | 99.05                       | –                      | –                       |
| 2  | PatchCore                                          | 正常特徴をメモリバンク化し、近傍距離で異常スコア化。                       | 多数実装   | 高精度／直感的   | メモリ・検索コスト高    | 93.30                       | –                      | 98.64                       | 57.67                  | –                       |
| 3  | CFA (Coupled Feature Adaptation)                   | 正常埋め込みをハイパースフィアに適合させ、外れを異常と判断。                   | 実装あり   | 高精度／効率的   | 調整必要／他ドメイン検証少 | 99.01                       | 87.96                  | 99.96                       | 75.66                  | 99.04                   |
| 4  | FastFlow                                           | 正規化フローで正常特徴分布を学習、尤度低下で異常検知。                      | 実装あり   | 解釈性あり／高精度 | 推論コスト高        | 97.63                       | 78.70                  | 99.60                       | –                      | 99.57                   |
| 5  | STFPM (Student–Teacher Feature Prediction Model)   | 教師–生徒構造で特徴再現誤差により異常検知。                           | 一部実装   | 局所化が得意    | 設計が重要／偏りに弱い   | 96.30                       | 77.83                  | 99.97                       | 77.30                  | 99.18                   |
| 6  | RIAD (Reconstruction–Inpainting Anomaly Detection) | 部分マスク再構成により異常領域を推定。                              | 実装あり   | 未知異常に強い   | 誤検知しやすい       | –                           | –                      | –                           | –                      | –                       |
| 7  | GANomaly                                           | GAN で正常分布を学び潜在距離で異常検知。                           | 複数実装   | 生成誤差活用可   | 学習不安定         | –                           | –                      | –                           | –                      | –                       |
| 8  | f-AnoGAN                                           | 潜在写像を導入した AnoGAN 改良型。                            | 実装あり   | 理解しやすい    | 精度劣る          | –                           | –                      | –                           | –                      | –                       |
| 9  | IAD + Inpainting                                   | 部分マスクを再構成し誤差で異常検知。                               | 実装あり   | 局所欠陥検出に強い | 照明変動に弱い       | **99.27**                   | **91.23**              | –                           | –                      | –                       |

---

### 📊 主な傾向

- **画像レベル**では IAD + Inpainting (99.27 / 91.23) が全体最高、次点は CFA (99.01 / 87.96)、FastFlow (97.63 / 78.70)。
- **ピクセルレベル**では STFPM が最も高い (ROC-AUC 99.97 / F1 77.30 / PRO 99.18)、次いで CFA (99.96 / 75.66 / 99.04)。
- 特徴量ベース（CFA, FastFlow, PatchCore）は画像レベルで強く、再構成／教師–生徒系（STFPM, IAD）は局所化性能に優れる。
