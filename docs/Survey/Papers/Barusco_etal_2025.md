<!-- markdownlint-disable MD053 -->

# Evaluating Modern Visual Anomaly Detection Approaches in Semiconductor Manufacturing: A Comparative Study

- **著者**：Manuel Barusco, Francesco Borsatti, Youssef Ben Khalifa, Davide Dalle Pezze, Gian Antonio Susto（イタリア・パドヴァ大学）
- **掲載形態**：プレプリント（arXiv）として2025年5月12日に公開。([arXiv][1])
- **分野**：自動外観検査、半導体製造、視覚異常検知（VAD：Visual Anomaly Detection）

---

## 内容詳細

### 背景と目的

- 半導体製造工場では、ウェーハ加工、金属配線、エッチングなど多数の工程を経てICが作られる。これらの工程では **顕微鏡（特に走査電子顕微鏡 SEM）画像** による自動外観検査（AVI）が重要であり、欠陥の早期発見によって歩留まり改善・設備停止削減・コスト低減が期待される。
- これまで多くの研究が「正常＋異常ラベル付き画像を用いた教師あり学習」ベースで進められてきたが、異常サンプルの入手やラベル付けが困難という実運用上の壁がある。
- この論文では、**正常サンプルのみを用いる異常検知（VAD）手法**を、半導体製造分野のSEM画像に対して適用・比較評価することを目的としている。これにより、実用的な検査システム構築のヒントや現在の技術の限界を明らかにしようとしている。

### データセットと手法

- 使用データセット：MIIC (Microscopic Images of Integrated Circuits)。IC金属層を撮影したグレースケールSEM画像から構成され、25,276枚（うち正常25,160枚、異常116枚）、解像度512×512ピクセル。
- なぜ重要か：多くのVAD研究では自然画像（たとえば自動車部品、ナッツ、ねじなど）を対象にしており、SEMなど専門的・工業的撮像モードの評価は少ないため、**半導体ドメイン特有のチャレンジ**が存在する。
- 比較手法：10のVAD手法を検証。
  - 特徴ベース（feature-based）手法：Pre-trained ネットワーク等から特徴を抽出 → 正常データの特徴記憶・異常データとの乖離を検知。
  - 再構成ベース（reconstruction-based）手法：正常画像を再構成するモデルを学習 → 再構成誤差が大きい場合を異常と判断。
- 評価指標：画像レベル（その画像が異常かどうか）およびピクセルレベル（異常箇所のマスク精度）でF1スコア、ROC-AUCなどを採用。

### 主な実験結果

- 画像レベルROC-AUCでは、いくつかの特徴ベース手法が90%以上の性能を示している（例：PatchCore 約93.3%、FastFlow 約97.6%）
- 画像レベルF1スコアでは、特徴ベース手法の中で特に CFA が約87.9% と最良を記録。
- ピクセルレベル（異常領域の局所化）では、画像レベルで最良だった手法が必ずしも最良ではなく、たとえば別手法（たとえば STFPM）が最良スコアという結果も出ている。
- 驚くべきことに、再構成ベース手法（古典的アプローチ）も非常に高い性能を記録しており、画像レベルF1で約91.2%という結果も報告されている。

### 考察・示唆

- **ドメインギャップ**：自然写真画像で学習・評価された手法をSEM画像にそのまま適用すると、性能が落ちる可能性があることが示唆されている。特徴抽出器が自然写真とSEMとで大きく異なる“視覚特性”を持つためである。
- **再構成ベースの再評価**：データが十分にある（この研究では25K枚以上の正常画像）場合、再構成ベース手法でも優れた性能を示し、特徴ベース手法と肩を並べる可能性があるという点が重要である。
- **運用上の実用性・説明可能性**：VAD手法は異常が出た領域の“異常マップ（どのピクセルが原因か）”を出すことが多く、エンジニアや品質保証担当者が“なぜ異常と判定されたか”を確認しやすいため、実工場への適用を想定した観点で有利である.

### 限界と今後の課題

- 116枚という異常サンプル数は少なく、異常の“多様性”や未知異常への対応という観点では制限がある。
- SEM画像という非常に専門的なモダリティであるため、世界中の研究が再現できるデータ・手法基盤（公開性・汎用性）をもっと拡充する必要がある。
- 特徴ベース手法をさらに改善するためには、ImageNet等自然画像で学習された特徴抽出器を**SEM用途にファインチューニング**したり、自己教師あり学習 (self-supervised) によるドメイン特化特徴学習を検討すべきと論文は提示している。
- 実運用では、異常発生頻度が非常に低く、ラベル付き異常がほとんど存在しないという状況が一般的。そのため“一般化／未見異常対応／真陽性／偽陽性のバランス”という観点でさらなる研究が必要である。

---

## 応用の観点から見たポイント（「半導体製造／異常検知AI」文脈で）

- この論文は **SEM画像の異常検知**という点で、「半導体製造における欠陥検出／画像分類／AIモデル構築」という文脈に非常に合致している。
- 正常データのみから学習するVADアプローチは、製造ラインで「出現頻度が少ない異常」を扱う場面において実運用メリットが大きく、ラベル付き異常データが少ない現場に向けた手法選定の重要なガイドになる。
- さらに、「画像レベル＋ピクセルレベル」での性能差／手法ごとの得意・不得意（検出 vs 局所化）を明示しているため、アプリケーション設計時に「欠陥検出するだけでよいか／どこで欠陥があるかも示したいか」という要件整理のヒントになる。
- また、「再構成ベースでも十分戦える」という点は、モデル選定時に“最新最先端＝特徴ベースしかあり得ない”という先入観を見直すきっかけになり得る。
- 実装時には、論文中のベンチマーク設定（画像解像度、正常訓練枚数、異常テスト枚数、使用手法のハイパーパラメータ等）を参照し、検証時のデータセット規模・画像仕様・ライン要件に合致させて “どの手法から試行するか” を決める良い出発点となる。

---

## 使用データセット

### ✅ 入手可能性

- データセットの詳細ページが Nanyang Technological University（NTU）によるデータリポジトリ “DR-NTU (Data)” 上に公開されている。([researchdata.ntu.edu.sg][2])
- GitHub 上にも “wenbihan/MIIC-IAD” というリポジトリがあり、データ説明およびダウンロードリンク（あるいはアクセス方法）が記載されている。([GitHub][3])
- データセットには「正常 25,160 枚／異常 116 枚、解像度 512×512 ピクセル」の SEM 画像で構成されている旨が記載されている。([oar.a-star.edu.sg][4])

---

### ⚠ 利用前の注意・条件

- 利用条件として「非商用研究利用のみ（Non-Commercial）」の旨が明記されている。たとえば、GitHub の README に「All data is subject to copyright and may only be used for non-commercial research.」とある。([GitHub][3])
- ライセンスは NTU のデータページ上で “CC BY-NC 4.0” と記載されている。([researchdata.ntu.edu.sg][2])
- ダウンロードにはアカウント登録や利用申請が必要な場合がある（特にファイルが “Request Access” 状態の場合があるようだ）。([researchdata.ntu.edu.sg][2])

---

### 🔍 ユーザー視点での確認ポイント

- 「商用利用」または「ライン実運用（量産品質管理）用途」でこのデータを使いたい場合、ライセンス制限（非商用）を確認・交渉する必要がある。
- 解像度や画像形式（512×512グレー画像）、異常マスク付き／バウンディングボックス付きといったアノテーション内容も把握できる（READMEに記載あり）。([GitHub][3])
- 自社の製造ラインで撮影している SEM 画像とこのデータセットの画質・条件（撮影装置／金属層／被検部位）とのギャップを検討することが重要である。
- ラベル付き異常が「116枚」と少数であるため、「未知異常」「発生頻度の極めて低い異常」への適用を考える際には注意が必要である。これは論文中でも実験条件の限界として言及されている。

---

## 10VAD手法

- ※ 本表は「正常データみだけ用いた異常検知（VAD：Visual Anomaly Detection）手法」で、製造業／半導体外観検査という文脈に適用可能なものとして選ばれている。論文中では課題や実験条件（例えば解像度512×512、正常25,160枚／異常116枚のSEM画像）を元に比較がなされている。
- ※ “実装公開状況”は2025年10月時点の一般公開状況に基づく簡易評価である。

| No  | 手法名         | 特徴概要                                     | 実装公開状況         | メリット                          | デメリット                     |
| --- | -------------- | -------------------------------------------- | -------------------- | --------------------------------- | ------------------------------ |
| 1   | f-anoGAN       | AnoGAN改良。潜在写像を高速化し再構成差で検知 | 実装あり             | 再構成/潜在距離併用・分かりやすい | 精度やや低・高解像度で重い     |
| 2   | GANanomaly     | GANで正常分布学習、再構成/潜在差で検知       | 複数実装             | 生成誤差活用・可視化容易          | 学習不安定・高解像度で訓練困難 |
| 3   | IAD+Inpainting | 部分マスク→インペインティング、誤差で検知    | 実装あり             | 未知異常に強い・簡潔              | 照明/テクスチャ変化で誤検知    |
| 4   | PatchCore      | メモリバンクと近傍距離で検知                 | 多数実装             | 高精度・直感的                    | メモリ/検索コスト高            |
| 5   | PaDiM          | パッチ位置ごとに多変量ガウスで正常をモデル化 | OSSあり              | シンプル・低計算量                | 未知異常に弱い・メモリ増       |
| 6   | CFA            | 特徴をハイパースフィア適合、外れを異常       | 実装あり             | 高精度・効率良                    | 調整必要・他ドメイン検証少     |
| 7   | STFPM          | 教師–生徒で特徴予測誤差→検知                 | 一部実装             | 局所化に強い                      | 設計依存・偏りに弱い           |
| 8   | R4AD           | Reverse Distillationで乖離検知               | 実装あり（派生含む） | 再現性/速度の両立                 | 設計/事前学習に依存            |
| 9   | FastFlow       | 正規化フローで正常尤度学習→検知              | 実装あり             | 解釈性・高精度                    | 学習/推論コスト高              |
| 10  | SuperSimpleNet | 教師あり/なし統合の高速表面欠陥検出          | 実装あり（論文）     | 高速・信頼性                      | ドメイン転移で性能変動         |

### 補足解説・活用メモ

- 本比較表を、ユーザーが「半導体製造／欠陥検出AI／SEM画像」を扱う文脈で活用する場合、以下点が設計・実装段階で特に重要である:
  1. **正常データ量・異常データ量の制限**：本論文では正常25,160枚／異常116枚というかなり偏った構成であり、ラベル付き異常が極めて少ないため、正常のみ学習型（VAD）手法が前提となっている。これは実製造ラインでも典型的な状況である。
  2. **SEM画像という専門撮像モード**：多くのVAD手法は自然画像 (例：MVTec AD 等) を前提としている。SEM画像はテクスチャ・コントラスト・ノイズ特性が異なるため、“ドメイン適応”あるいは“ファインチューニング”を要する可能性がある。論文でもこのドメインギャップを指摘している。
  3. **リアルタイム適用／実運転環境**：製造ラインへの適用を想定するなら、メモリ・推論速度・FPGA/エッジ環境での実装性／誤検知／未見異常対応といった実装上の課題がある。上表の「メリット／デメリット」欄から実装設計時にどの手法が“現場仕様”に近いかを判断できる。
  4. **実装公開状況の確認**：実際に試作・実験するなら、GitHub 等で「実装済」「動作確認済」の手法を優先した方が早期検証が可能である。例えばPaDiM・PatchCore・FastFlow 等は実装が比較的充実している。
  5. **どこを重視するかで選定**：「画像レベル（異常かどうか）精度を重視するか」「ピクセルレベル（異常領域どこか）も重視するか」「推論速度／モデルサイズを重視するか」によって、上記手法の適合度が変わる。たとえば、「どこに異常があるかも示したい」なら、PatchCore・CFA・STFPM 等が有利である可能性がある。

---

### 表3: MIICデータセットにおける評価対象VAD手法の検出（画像レベル）および局所化（ピクセルレベル）の性能

- "\*" が付いた手法は原論文の結果を引用し、それ以外は本研究の実装で評価した結果である。

| VAD Method       | ROC (Image) | F1 (Image) | PR (Image) | ROC (Pixel) | F1 (Pixel) | PR (Pixel) | PRO (Pixel) |
| ---------------- | ----------- | ---------- | ---------- | ----------- | ---------- | ---------- | ----------- |
| f-anoGAN\*       | 56.38       | 31.65      | –          | –           | –          | –          | –           |
| GANanomaly\*     | 93.34       | 74.64      | –          | –           | –          | –          | –           |
| IAD+Inpainting\* | 99.27       | 91.23      | –          | –           | –          | –          | –           |
| PatchCore        | 93.33       | 75.51      | 78.22      | 98.64       | 57.67      | 44.88      | 93.03       |
| PaDiM            | 84.89       | 47.55      | 47.29      | 99.05       | 22.98      | 13.86      | 95.30       |
| CFA              | 99.01       | 87.96      | 94.28      | 99.96       | 75.66      | 78.91      | 99.04       |
| STFPM            | 96.32       | 77.83      | 83.31      | 99.97       | 77.30      | 80.77      | 99.18       |
| R4AD             | 93.93       | 68.48      | 72.28      | 99.85       | 56.94      | 54.92      | 98.45       |
| FastFlow         | 97.63       | 78.70      | 86.17      | 99.60       | 53.02      | 46.03      | 99.57       |
| SuperSimpleNet   | 96.23       | 80.72      | 86.65      | 98.46       | 50.57      | 43.84      | 97.59       |

---

### 📊 主な傾向

- **画像レベル**では IAD + Inpainting (99.27 / 91.23) が全体最高、次点は CFA (99.01 / 87.96)、FastFlow (97.63 / 78.70)。
- **ピクセルレベル**では STFPM が最も高い (ROC-AUC 99.97 / F1 77.30 / PRO 99.18)、次いで CFA (99.96 / 75.66 / 99.04)。
- 特徴量ベース（CFA, FastFlow, PatchCore）は画像レベルで強く、再構成／教師–生徒系（STFPM, IAD）は局所化性能に優れる。

---

[1]: https://arxiv.org/abs/2505.07576?utm_source=chatgpt.com "Evaluating Modern Visual Anomaly Detection Approaches in Semiconductor Manufacturing: A Comparative Study"
[2]: https://researchdata.ntu.edu.sg/dataset.xhtml?persistentId=doi%3A10.21979%2FN9%2FWBLTFI&utm_source=chatgpt.com "MIIC (Microscopic Images of Integrated Circuits) Dataset for ..."
[3]: https://github.com/wenbihan/MIIC-IAD?utm_source=chatgpt.com "MIIC Dataset for Image Anomaly Detection - GitHub"
[4]: https://oar.a-star.edu.sg/storage/5/5gqr8v86x3/icip-2021-sagan-final.pdf?utm_source=chatgpt.com "[PDF] joint anomaly detection and inpainting for microscopy images"
[5]: https://www.semanticscholar.org/paper/PaDiM%3A-a-Patch-Distribution-Modeling-Framework-for-Defard-Setkov/2e8d62277e40d465343e8dfb32ecc246f320540e?utm_source=chatgpt.com "a Patch Distribution Modeling Framework for Anomaly ..."
