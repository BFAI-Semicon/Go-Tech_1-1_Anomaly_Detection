# 設計書

## 概要

本設計書は、Marp プレゼン資料（`docs/report.md`）の
スライド構成・コンテンツ設計・技術仕様を定義する。

### 設計方針

- **成果物**: `docs/report.md`（Marp 互換 Markdown 1 ファイル）
- **テーマ**: Marp built-in `default`（シンプル・高可読性）
- **本編**: 10 スライド（表紙含む）
- **付録**: 3 スライド（枚数制限対象外）
- **言語トーン**: 導入部・結論部は平易な日本語、
  技術スライドは正確性を優先

## 要件トレーサビリティ

| 要件 |               概要                |      対応スライド      |
| ---- | --------------------------------- | ---------------------- |
| 1.1  | 表紙にタイトル・所属・氏名・日付  | S1                     |
| 1.2  | 目的と報告対象期間                | S2                     |
| 1.3  | 導入の平易な表現                  | S2, S4                 |
| 1.4  | 目次（【１－１】【１－２】対応）  | S3                     |
| 2.1  | 文献調査結果の要約                | S5                     |
| 2.2  | 半導体向け論文サーベイ            | S5, S6                 |
| 2.3  | モデル検証計画                    | S7                     |
| 2.4  | LeadersBoard ステータス           | S8                     |
| 2.5  | 参照元の脚注・ノート              | 全技術スライド         |
| 3.1  | 【１－２】実施中の明示            | S9                     |
| 3.2  | 今後の方針                        | S9                     |
| 4.1  | 背景→成果→考察→次アクションの流れ | S4→S5-S9→S10           |
| 4.2  | 結論・まとめスライド              | S10                    |
| 4.3  | 結論の平易な表現                  | S10                    |
| 4.4  | 付録セクション                    | A1-A3                  |
| 4.5  | 本編 10 ページ                    | S1-S10（10 枚）        |
| 5.1  | 図表にタイトル・単位・出典        | S6, S7, S8             |
| 5.2  | 1 スライド 1 メッセージ           | 全スライド             |
| 5.3  | 定量情報は Markdown テーブル      | S6, S7, S8             |
| 5.4  | Marp ディレクティブ統一           | フロントマター         |
| 6.1  | Marp フロントマター               | ファイル先頭           |
| 6.2  | `---` スライド区切り              | 全スライド間           |
| 6.3  | 外部画像非依存                    | テキスト・テーブルのみ |
| 6.4  | 発表者ノート                      | 全スライド             |

## 技術スタック

|   レイヤー   |              ツール              |            役割             |
| ------------ | -------------------------------- | --------------------------- |
| プレゼン形式 | Marp（built-in default テーマ）  | Markdown → スライド変換     |
| プレビュー   | Marp for VS Code                 | devcontainer 内でプレビュー |
| 出力（任意） | marp-cli（未導入・必要時に追加） | PDF/HTML 変換               |

## Marp フロントマター設計

ファイル先頭に以下のフロントマターを配置する。

```yaml
marp: true
theme: default
paginate: true
header: "AI画像検査技術の研究開発"
footer: "株式会社BFAIセミコンダクタソリューションズ"
```

### ディレクティブ設計判断

- **`theme: default`**: 最もシンプルで可読性が高い。
  管理機関向け報告資料にはデザイン性より情報伝達を優先
- **`paginate: true`**: 全スライドにページ番号を表示
- **`header`**: 研究開発テーマの短縮名を常時表示
- **`footer`**: 所属組織名を常時表示
- **表紙のみ `_paginate: skip`** で
  ページ番号・ヘッダー・フッターを非表示

## スライド構成詳細設計

### S1: 表紙

- **タイトル**: 高度判断能力と応用拡張性を持つ
  先端半導体製造ライン向けＡＩ画像検査技術の研究開発
- **所属**: 株式会社BFAIセミコンダクタソリューションズ
- **報告者**: 長島剛宏
- **日付**: 2026-02-19
- **Marp ディレクティブ**:
  `<!-- _paginate: skip -->` で番号非表示
- **要件対応**: 1.1

### S2: 本資料の目的

- **スライドタイトル**: 本資料の目的
- **メッセージ**: 本研究開発の進捗と成果を
  管理機関へ報告する
- **コンテンツ**:
  - 報告対象期間: 2025 年度
  - 報告の目的: 進捗共有・成果報告
  - 対象テーマの概要（平易な表現）:
    「半導体製造の品質検査を AI で自動化するための
    研究開発の進捗をご報告します」
- **発表者ノート**: 想定読者が非専門家であることを意識し、
  技術用語を使わない補足説明
- **要件対応**: 1.2, 1.3

### S3: 目次

- **スライドタイトル**: 目次
- **コンテンツ**: 番号付きリストで全体構成を提示
  1. 研究開発の背景と目的
  1. 【１－１】教師なし学習に基づく異常判定機能の設計
     - 文献調査の概要と主要知見
     - モデル性能比較（MIIC データセット）
     - モデル検証計画
     - LeadersBoard 実験プラットフォーム
  1. 【１－２】欠陥箇所の可視化機能の設計
  1. まとめと今後の計画
- **要件対応**: 1.4

### S4: 研究開発の背景と目的

- **スライドタイトル**: 研究開発の背景と目的
- **メッセージ**: なぜこの研究が必要か、
  何を目指しているか
- **コンテンツ**（平易な表現）:
  - **背景**: 半導体の品質検査は現在、
    人の目に頼る部分が多く、
    検査の速度と精度に限界がある
  - **目的**: AI 技術を活用して、
    製造ラインの画像検査を自動化・高精度化する
  - **2 つのテーマ**:
    【１－１】異常を見つける AI の開発、
    【１－２】異常箇所を見える化する技術の開発
- **発表者ノート**: 専門用語（教師なし学習・異常検知等）の
  平易な言い換えを記載
- **要件対応**: 4.1（ストーリーライン導入）

### S5: 文献調査の概要と主要知見

- **スライドタイトル**:
  文献調査の概要と主要知見
- **メッセージ**: 最新の AI 手法を調査し、
  半導体検査に適用可能な候補を特定した
- **コンテンツ**:
  - 調査概要: 2023-2025 年の最新手法 +
    2020-2022 年の基盤手法を対象
  - 半導体製造向け論文 4 件を精読
    （Huang 2015, Hütten 2024, Schlosser 2022,
    Barusco 2025）
  - 主要知見:
    - 正常データのみで学習する手法が
      半導体検査に適している
    - 特徴ベース手法（CFA, FastFlow）が高精度
    - 再構成ベース手法も十分な性能を示す
  - ライセンス課題: 商用利用可能なライセンスの
    確認が重要
- **発表者ノート**: 出典 `docs/Survey/Papers/survey_results.md`,
  `docs/Survey/Papers/4papers_for_semicon_industry.md`
- **要件対応**: 2.1, 2.2, 2.5

### S6: MIIC データセットでのモデル性能比較

- **スライドタイトル**:
  半導体 SEM 画像での AI モデル性能比較
- **メッセージ**: 10 手法を比較し、
  CFA・STFPM・FastFlow が有望
- **コンテンツ**: Barusco et al. (2025) の性能比較表を
  上位 5 手法に絞って掲載

```markdown
|      手法      | 画像ROC | 画像F1 | ピクセルF1 |
| -------------- | ------- | ------ | ---------- |
| CFA            | 99.01   | 87.96  | 75.66      |
| FastFlow       | 97.63   | 78.70  | 53.02      |
| STFPM          | 96.32   | 77.83  | 77.30      |
| SuperSimpleNet | 96.23   | 80.72  | 50.57      |
| PatchCore      | 93.33   | 75.51  | 57.67      |
```

- **注記**: データセット MIIC（SEM 画像 25,276 枚）、
  出典 Barusco et al. (2025)
- **発表者ノート**: 出典 `docs/Survey/Papers/Barusco_etal_2025.md`、
  全 10 手法の完全テーブルは付録 A2 を参照
- **要件対応**: 2.2, 5.1, 5.3

### S7: モデル検証計画

- **スライドタイトル**:
  10 モデルの検証計画（MIIC データセット）
- **メッセージ**: 10 種類の異常検知モデルを
  半導体画像で検証予定
- **コンテンツ**:
  - MIIC データセット概要（正常 25,160 枚 / 異常 116 枚）
  - 検証対象: 代表的 5 モデルをテーブルで提示

```markdown
|   モデル    |     系統     |    主用途    |
| ----------- | ------------ | ------------ |
| PaDiM       | 統計         | ベースライン |
| PatchCore   | メモリバンク | 高精度       |
| FastFlow    | Flow         | 高速推論     |
| EfficientAD | 工業向け     | Edge展開     |
| DRAEM       | 再構成       | 説明性       |
```

- **評価指標**: AUROC, AUPRC, F1-Score
- **補足**: 全 10 モデルは付録 A3 を参照
- **発表者ノート**: 出典
  `docs/Survey/Experiments/MIIC_10models.md`
- **要件対応**: 2.3, 5.1, 5.3

### S8: LeadersBoard 実験プラットフォーム

- **スライドタイトル**:
  LeadersBoard — ML 実験プラットフォーム
- **メッセージ**: モデル評価を自動化・標準化する
  プラットフォームを構築した
- **コンテンツ**:
  - 概要: コード提出 → GPU 学習・評価 →
    結果可視化の自動パイプライン
  - 主要機能: 提出受付、非同期ジョブ実行、
    MLflow 実験管理、Streamlit UI
  - 現状ステータス:

```markdown
|    項目    |      値      |
| ---------- | ------------ |
| バージョン | 0.1.0        |
| フェーズ   | 本番準備完了 |
| テスト数   | 87件         |
| カバレッジ | 77%          |
```

- **発表者ノート**: 出典
  `.kiro/steering/product.md`、
  技術詳細（Clean-lite 設計、
  ポート/アダプタパターン等）は口頭で補足
- **要件対応**: 2.4, 5.1, 5.3

### S9: 【１－２】欠陥箇所の可視化機能の設計

- **スライドタイトル**:
  【１－２】欠陥箇所の可視化機能 — 現在実施中
- **メッセージ**: 本テーマは現在設計・調査を進めている
- **コンテンツ**:
  - ステータス: **現在実施中**
  - 目的: 異常と判定された箇所を
    可視化（ヒートマップ等）し、
    検査担当者が確認しやすい形で提示する
  - 今後の方向性:
    異常検知モデルの出力する異常マップを活用した
    可視化手法の設計・検証を予定
- **発表者ノート**: 出典 `docs/index.md`、
  詳細はまだ未定のため概要レベルに留める
- **要件対応**: 3.1, 3.2

### S10: まとめと今後の計画

- **スライドタイトル**: まとめと今後の計画
- **メッセージ**: 成果と次のステップを
  簡潔にまとめる（平易な表現）
- **コンテンツ**（非専門家向け平易表現）:
  - **これまでの成果**:
    - 最新の AI 技術を幅広く調査し、
      半導体検査に有望な手法を特定した
    - 手法の性能を客観的に比較する
      実験基盤を構築した（LeadersBoard）
    - 半導体画像での検証計画を策定した
  - **現時点の課題**:
    - 半導体の電子顕微鏡画像は一般的な写真と
      性質が異なり、AI の精度に影響する可能性がある
      （ドメインギャップ）
    - 有望な手法の一部にライセンス制約があり、
      商用利用可否の確認が必要
    - 異常画像が少数（116 枚）のため、
      検証結果の信頼性確保に工夫が求められる
  - **今後の計画**:
    - 特定した有望手法を半導体画像で検証する
    - 異常箇所の可視化技術の設計を進める
    - 実製造ラインへの適用に向けた課題を整理する
- **発表者ノート**: 各成果と対応するスライド番号を記載
- **要件対応**: 4.2, 4.3

## 付録スライド設計

### A1: 文献調査 — 半導体製造向け論文 4 件

- Huang & Pan (2015), Hütten et al. (2024),
  Schlosser et al. (2022), Barusco et al. (2025) の
  比較表を `4papers_for_semicon_industry.md` から転記
- **要件対応**: 4.4

### A2: MIIC データセット — 全 10 手法の性能テーブル

- Barusco et al. (2025) の Table 3 を完全転記
  （画像レベル + ピクセルレベル 全指標）
- **要件対応**: 4.4, 5.3

### A3: 検証対象 10 モデル一覧

- `MIIC_10models.md` の 10 モデルテーブルを完全転記
  （系統・異常検知原理・主用途・ステータス）
- **要件対応**: 4.4, 5.3

## ファイル配置

```text
docs/
  report.md          ← 成果物（Marp Markdown）
  index.md           ← 既存（変更なし）
  Survey/            ← 既存（変更なし、参照のみ）
```

## 非専門家向け用語置換リスト

技術スライド（S5-S8）では正確な用語を使用するが、
導入部（S2, S4）と結論部（S10）では
以下の置換を適用する。

|     技術用語     |                      平易な表現                      |
| ---------------- | ---------------------------------------------------- |
| 教師なし学習     | 正常な画像だけを手本にして学ぶ AI                    |
| 異常検知         | 不良品を自動で見つける技術                           |
| SEM 画像         | 電子顕微鏡で撮影した半導体の拡大画像                 |
| 特徴ベース手法   | 画像の特徴パターンを覚えて異常を見つける方法         |
| 再構成ベース手法 | 正常な画像を再現し、再現できない部分を異常とする方法 |
| AUROC            | 検知精度を測る指標                                   |
| anomalib         | 異常検知 AI のツールキット                           |
| MLflow           | 実験結果を記録・比較するツール                       |
| LeadersBoard     | AI モデルの性能を自動で評価・比較する仕組み          |

## テスト方針

- Marp for VS Code でプレビュー表示し、
  全スライドの描画を確認
- スライド枚数が本編 10 枚 + 付録 3 枚であること
- フロントマター設定が正しく反映されること
  （ページ番号、ヘッダー、フッター）
- 表紙のページ番号・ヘッダー・フッターが非表示であること
- テーブルが崩れずに描画されること
- `pymarkdown scan` でエラーがないこと（Marp 固有構文を除く）
